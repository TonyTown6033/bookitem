# 可视化时间轴预约功能说明

## 🎯 功能概述

新增了基于时间轴的可视化会议室预约功能，用户可以直观地看到会议室的占用情况，并通过拖动选择时间段进行预约。

## ✨ 主要特性

### 1. 可视化时间轴
- **白色区域**：可用时间段
- **浅灰色斜纹**：过去的时间（不可预约）
- **深灰色区域**：已被预约的时间段
- **蓝色半透明**：当前选择的时间段
- **红色半透明**：有冲突的选择（不可预约）

### 2. 交互方式
- **鼠标拖动**：在时间轴上按住鼠标左键拖动选择时间区间
- **实时反馈**：拖动时实时显示选择的时间范围
- **冲突检测**：自动检测是否与现有预约冲突
- **最小时长**：最少预约30分钟（半小时）
- **时间单位**：以30分钟为单位对齐

### 3. 预约流程
1. 选择日期（默认今天，不能选择过去的日期）
2. 选择会议室
3. 在时间轴上拖动选择时间段
4. 确认预约后填写会议信息
   - 预约人
   - 会议主题
   - 会议描述
   - 参与人数

## 🎨 界面设计

### 会议室卡片
```
┌─────────────────────┐
│   🏢 大会议室        │
│   📍 1楼101室        │
│   👤 20人           │
│   ✅ 可用           │
└─────────────────────┘
```

### 时间轴示例
```
00:00  04:00  08:00  12:00  16:00  20:00  24:00
├──────┼──────┼──────┼──────┼──────┼──────┤
│ ///  │  ████│      │██████│  👆  │      │
│ 过去 │  已预│      │已预约│ 选择 │      │
│ 时间 │  约  │      │      │      │      │
│      │      │      │      │      │      │
└──────┴──────┴──────┴──────┴──────┴──────┘
        浅灰斜纹 = 过去时间（不可预约）
        深灰色 = 已预约
        白色 = 可用
        蓝色 = 当前选择
```

## 📱 使用说明

### 访问预约页面
1. 点击导航栏的 "会议室预约"
2. 或从首页点击 "会议室预约" 卡片
3. 访问 http://localhost:5173/booking

### 创建预约步骤

#### 步骤 1：选择会议室
- 浏览可用的会议室列表
- 点击想要预约的会议室卡片
- 只有 "可用" 状态的会议室可以被选择

#### 步骤 2：选择日期
- 使用日期选择器选择预约日期
- 不能选择过去的日期
- 默认显示今天

#### 步骤 3：查看时间轴
- 白色区域表示可以预约的时间
- 灰色区域表示已经被预约
- 鼠标悬停在灰色区域可以看到预约详情

#### 步骤 4：选择时间段
- 在白色区域按住鼠标左键
- 向左或向右拖动选择时间范围
- 释放鼠标完成选择
- 最少选择30分钟（半小时）
- 时间会自动对齐到半小时（如 14:00, 14:30, 15:00...）

#### 步骤 5：确认时间
- 系统自动检测是否有冲突
- ✅ 绿色提示 = 可以预约
- ❌ 红色提示 = 有冲突，需要重新选择

#### 步骤 6：填写信息
- 点击 "确认预约" 按钮
- 填写会议信息：
  - 预约人（必填）
  - 会议主题（必填）
  - 会议描述（可选）
  - 参与人数（必填）

#### 步骤 7：提交预约
- 点击 "确认预约" 提交
- 预约成功后会自动刷新时间轴

## 🎯 使用技巧

### 1. 快速预约
- 直接在时间轴上拖动，无需手动输入时间
- 支持任意时长的预约（以30分钟为单位）
- 自动对齐到半小时刻度

### 2. 查看时间段状态
- 鼠标悬停在**浅灰色斜纹**区域：提示"过去的时间不可预约"
- 鼠标悬停在**深灰色**区域：显示预约人和时间范围
- 白色区域：可以直接拖动选择

### 3. 重新选择
- 点击 "重新选择" 按钮清除当前选择
- 可以重新在时间轴上拖动选择

### 4. 避免冲突
- 选择时避开所有灰色区域（过去时间和已预约）
- 选择的时间段不能跨越灰色区域
- 不能选择过去的时间
- 系统会自动提示冲突原因

## 🔍 技术实现

### 前端组件

#### 1. TimelineSelector.vue
可视化时间轴选择组件：
- 实时渲染24小时时间轴
- 显示已预约时间段
- 支持鼠标拖动选择
- 实时冲突检测
- 响应式设计

#### 2. RoomBooking.vue
会议室预约主页面：
- 会议室列表展示
- 时间轴集成
- 预约表单对话框
- 数据管理和提交

### 交互逻辑

```javascript
// 时间轴选择逻辑
1. mousedown → 记录起始位置
2. mousemove → 计算当前位置，更新选择区域
3. mouseup → 确认选择，显示操作按钮

// 冲突检测
检查选择的时间段是否与已有预约重叠：
- 开始时间在已有预约内
- 结束时间在已有预约内
- 完全包含已有预约
```

### 数据流

```
用户操作 → TimelineSelector
    ↓
  emit 事件
    ↓
RoomBooking 组件
    ↓
显示预约对话框
    ↓
用户填写信息
    ↓
提交到后端 API
    ↓
刷新时间轴
```

## 🎨 样式特点

### 颜色语义
- **白色**：可用时间（#FFFFFF）
- **浅灰色斜纹**：过去的时间（#F5F5F5 斜纹）
- **深灰色渐变**：已预约（#D0D0D0 → #A0A0A0）
- **蓝色半透明**：当前选择（rgba(64, 158, 255, 0.3-0.5)）
- **红色半透明**：无效选择（rgba(245, 108, 108, 0.3-0.5)）
- **绿色提示**：可以预约（#67C23A）
- **红色提示**：有冲突（#F56C6C）

### 动画效果
- 选择区域脉冲动画
- 会议室卡片悬停效果
- 平滑的过渡动画

## 📊 优势对比

### 传统方式 vs 时间轴方式

| 特性 | 传统日期选择器 | 时间轴可视化 |
|------|---------------|-------------|
| 可用性查看 | ❌ 需要手动查询 | ✅ 一目了然 |
| 时间选择 | ❌ 手动输入 | ✅ 拖动选择 |
| 冲突检测 | ❌ 提交后才知道 | ✅ 实时反馈 |
| 用户体验 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 操作步骤 | 5-6 步 | 3-4 步 |

## 🚀 后续优化

### 计划中的功能
- [ ] 多日期范围选择
- [ ] 按小时/按天视图切换
- [ ] 拖动调整已选时间段
- [ ] 快速预约模板
- [ ] 会议室推荐功能
- [ ] 移动端触摸优化

### 性能优化
- [ ] 虚拟滚动（大量预约时）
- [ ] 预约数据缓存
- [ ] 懒加载会议室列表

## 📝 注意事项

### 使用限制
1. **最小预约时长**：30分钟（半小时）
2. **时间单位**：30分钟为一个单位
3. **时间限制**：不能预约过去的时间
4. **日期限制**：不能预约过去的日期
5. **会议室状态**：只能预约"可用"的会议室

### 最佳实践
1. 提前规划会议时间
2. 留意会议室容量
3. 填写清晰的会议主题
4. 及时取消不需要的预约

## 🆘 常见问题

### Q: 选择的时间段显示红色？
A: 表示与现有预约冲突，请重新选择其他时间段。

### Q: 无法选择某个会议室？
A: 该会议室可能处于"不可用"状态，请联系管理员。

### Q: 最小预约时长是多少？
A: 最少30分钟（半小时），系统会自动对齐到半小时单位。

### Q: 为什么选择的时间显示为红色？
A: 可能的原因：
1. 选择了过去的时间（浅灰色斜纹区域）
2. 与已有预约冲突（深灰色区域）
3. 预约时长少于30分钟

### Q: 今天的时间轴为什么有一部分是灰色的？
A: 浅灰色斜纹区域表示当前时间之前的部分，这些是过去的时间，无法预约。

### Q: 可以预约跨天的会议吗？
A: 当前版本只支持单日预约，跨天预约功能将在后续版本中支持。

### Q: 如何取消已创建的预约？
A: 进入"预约记录"页面，找到对应预约点击"取消"按钮。

## 🎓 技术参考

### 核心技术
- Vue 3 Composition API
- Element Plus UI
- CSS Grid/Flexbox
- 鼠标事件处理
- 日期时间计算

### 关键文件
- `frontend/src/components/TimelineSelector.vue` - 时间轴组件
- `frontend/src/views/RoomBooking.vue` - 预约页面
- `frontend/src/router/index.js` - 路由配置

---

**版本**: v1.1.0  
**更新日期**: 2025-11-19  
**功能状态**: ✅ 已完成并测试

